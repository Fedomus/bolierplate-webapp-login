(()=>{"use strict";var e={700:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=r(198);t.default=class{constructor(){this.dao=new n.usuariosDAO}comprobarAutorizacion(e,t){return o(this,void 0,void 0,(function*(){try{return(yield this.dao.validarEmail(e))?(yield this.dao.validarContrasenia(e,t))?"contrasenia correcta":"contrasenia incorrecta":"email incorrecto"}catch(e){return console.log("Error en comprobarAutorizacion. ",e)}}))}agregarUsuario(e,t){return o(this,void 0,void 0,(function*(){return!(yield this.dao.validarEmail(e))&&(yield this.dao.agregarUsuario(e,t),!0)}))}}},752:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const n=o(r(860)),i=o(r(185));t.App=class{constructor(e,t,r,o="/public"){this.port=e,this.staticPath=o,this.app=(0,n.default)(),this.middleware=t,this.routers=r}start(){this.startMiddleware(this.middleware),this.startRouters(this.routers),this.assets(this.staticPath),this.setTemplateEngine(),this.listen()}startMiddleware(e){e.forEach((e=>{this.app.use(e)}))}addMiddleWare(e){this.app.use(e)}startRouters(e){e.forEach((e=>{this.app.use(e.path,e.name)}))}assets(e){this.app.use(n.default.static(e))}setTemplateEngine(){this.app.set("view engine","ejs"),this.app.set("views","./src/views")}connectDB(e){const t=()=>{i.default.connect(e).then((()=>{})).catch((e=>(console.log("Falló la conexión a la Base de Datos \n",e),process.exit(1))))};t(),i.default.connection.on("disconnected",t)}listen(){this.app.listen(this.port,(()=>{console.log("Aplicación escuchando en puerto ",this.port)}))}}},14:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(700)),a=n(r(552)),s=n(r(244));t.default=class{constructor(){this.api=new i.default}getLogin(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/login.ejs",{error:!1})}catch(e){return console.log("Error en getLogin. ",e)}}))}postLogin(e,t){return o(this,void 0,void 0,(function*(){try{const{email:r,contrasenia:o}=e.body;if(!r||!o)return t.render("../views/pages/login",{error:"Debe completar todos los campos."});switch(yield this.api.comprobarAutorizacion(r,o)){case"email incorrecto":return t.render("../views/pages/login",{error:"Error, email incorrecto"});case"contrasenia incorrecta":return t.render("../views/pages/login",{error:"Error, contraseña incorrecta"});case"contrasenia correcta":return e.session.email=r,e.session.usuarioLogueado=!0,e.session.save(),t.redirect("/home")}}catch(e){return void console.log("Error en postLogin. ",e)}}))}getSignUp(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/signup",{error:!1,mensaje:null})}catch(e){return console.log("Error en getSignUp. ",e)}}))}postSignUp(e,t){return o(this,void 0,void 0,(function*(){try{const r=e.body.email;if(r){const e=(0,a.default)(8);return yield this.api.agregarUsuario(r,e).then((n=>o(this,void 0,void 0,(function*(){return n?(yield(0,s.default)(r,e))?t.render("../views/pages/login",{error:!1,mensaje:"Se le fue enviada la contraseña a su dirección de email."}):t.render("../views/pages/signup",{error:!0,mensaje:"Hubo un error al intentar enviarle el mail."}):t.render("../views/pages/signup",{error:!0,mensaje:"Ya existe un usuario registrado con ese email."})}))))}return t.render("../views/pages/signup",{error:!0,mensaje:"Debe completar todos los campos."})}catch(e){return console.log("Error en postSignUp. ",e)}}))}}},24:function(e,t){var r=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{getRoot(e,t){return r(this,void 0,void 0,(function*(){try{return t.sendFile(__dirname+"/index.html")}catch(e){return console.log("Error en getRoot. ",e)}}))}getHome(e,t){return r(this,void 0,void 0,(function*(){try{return t.sendFile(__dirname+"/home.html")}catch(e){return console.log("Error en getHome. ",e)}}))}}},176:function(e,t){var r=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{obtenerTurnos(e,t){return r(this,void 0,void 0,(function*(){}))}guardarTurno(e,t){return r(this,void 0,void 0,(function*(){}))}actualizarTurno(e,t){return r(this,void 0,void 0,(function*(){}))}borrarTurno(e,t){return r(this,void 0,void 0,(function*(){}))}}},397:function(e,t,r){var o,n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ENV=void 0,n(r(142)).default.config(),t.ENV={stage:"production",port:null!==(o=process.env.PORT)&&void 0!==o?o:8080,mongo_uri:process.env.MONGO_URI,client_secret:process.env.CLIENT_SECRET,client_id:process.env.CLIENT_ID,refresh_token:process.env.REFRESH_TOKEN,acces_token:process.env.ACCES_TOKEN,tiempo_expiracion:process.env.TIEMPO_EXPIRACION?parseInt(process.env.TIEMPO_EXPIRACION):1e5}},409:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(!e.session.usuarioLogueado)return t.redirect("/");r()}},327:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.middlewareGlobal=void 0;const n=o(r(508)),i=r(986),a=o(r(582)),s=o(r(455)),u=o(r(730)),c=r(397);t.middlewareGlobal=[i.json(),i.urlencoded({extended:!0}),(0,a.default)(),(0,s.default)(),(0,n.default)({store:u.default.create({mongoUrl:c.ENV.mongo_uri,mongoOptions:{useNewUrlParser:!0,useUnifiedTopology:!0}}),secret:"mafalda",resave:!1,saveUninitialized:!1,cookie:{maxAge:c.ENV.tiempo_expiracion}})]},198:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usuariosDAO=void 0;const i=n(r(403)),a=r(905),s=r(95),u=n(r(85));class c extends i.default{constructor(){super(a.usuariosModel),this.id=1}obtenerPorEmail(e){return o(this,void 0,void 0,(function*(){try{return yield this.model.findOne({email:e}).then((e=>e||null))}catch(e){return console.log("Error en obtenerPorEmail. ",e)}}))}validarEmail(e){return o(this,void 0,void 0,(function*(){try{return yield this.model.findOne({email:e}).then((e=>!!e))}catch(e){return console.log("Error en validarEmail. ",e)}}))}validarContrasenia(e,t){return o(this,void 0,void 0,(function*(){const r=yield this.obtenerPorEmail(e);return!!(0,u.default)(r,t)}))}agregarUsuario(e,t){return o(this,void 0,void 0,(function*(){try{const r={id:this.id,email:e,contrasenia:(0,s.createHash)(t)};return yield this.guardarElemento(r),void(this.id=this.id+1)}catch(e){return console.log("Error en agregarUsuario. ",e)}}))}}t.usuariosDAO=c},403:function(e,t){var r=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.model=e}guardarElemento(e){return r(this,void 0,void 0,(function*(){try{return yield this.model.insertMany(e)}catch(e){return console.log("Error en guardarElemento. ",e)}}))}obtenerElementos(e){return r(this,void 0,void 0,(function*(){try{return e?yield this.model.findOne({id:e}):yield this.model.find({})}catch(e){return console.log("Error en obtenerElementos. ",e)}}))}eliminarPorId(e){return r(this,void 0,void 0,(function*(){try{return yield this.model.deleteOne({id:e})}catch(e){return console.log("Error en eliminarPorId. ",e)}}))}actualizarPorId(e,t){return r(this,void 0,void 0,(function*(){try{return yield this.model.updateOne({id:e},{$set:{elem:t}})}catch(e){return console.log("Error en actualizarPorId. ",e)}}))}}},905:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.usuariosModel=void 0;const o=r(185),n=new o.Schema({id:{type:Number,required:!0},email:{type:String,required:!0,max:100},contrasenia:{type:String,required:!0}});t.usuariosModel=(0,o.model)("usuarios",n)},274:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=o(r(14)),i=o(r(24)),a=r(860),s=o(r(409)),u=o(r(176));t.default=class{constructor(){this.authController=new n.default,this.rootController=new i.default,this.turnosController=new u.default}auth(){const e=(0,a.Router)();return e.get("/login",((e,t)=>{this.authController.getLogin(e,t)})),e.post("/login",((e,t)=>{this.authController.postLogin(e,t)})),e.get("/signup",((e,t)=>{this.authController.getSignUp(e,t)})),e.post("/signup",((e,t)=>{this.authController.postSignUp(e,t)})),e}root(){const e=(0,a.Router)();return e.get("/",((e,t)=>{this.rootController.getRoot(e,t)})),e.get("/home",((e,t,r)=>(0,s.default)(e,t,r)),((e,t)=>{this.rootController.getHome(e,t)})),e}turnos(){const e=(0,a.Router)();return e.get("/:id?",((e,t)=>{this.turnosController.obtenerTurnos(e,t)})),e.post("/",((e,t)=>{this.turnosController.guardarTurno(e,t)})),e.put("/:id",((e,t)=>{this.turnosController.actualizarTurno(e,t)})),e.delete("/:id",((e,t)=>{this.turnosController.borrarTurno(e,t)})),e}}},728:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(397),i=r(752),a=r(327),s=new(o(r(274)).default),u=n.ENV.port;let c;try{c=n.ENV.mongo_uri}catch(e){c=null,console.log("Error al obtener la URI de MongoDB")}const l=new i.App(u,a.middlewareGlobal,[{path:"/auth",name:s.auth()},{path:"/",name:s.root()},{path:"/api/turnos",name:s.turnos()}]);c?l.connectDB(c):console.log("El servidor no se conectó a la Base de Datos porque no fue ingresada la variable de entorno correspondiente."),l.start()},244:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(184)),a=r(397);t.default=function(e,t){return o(this,void 0,void 0,(function*(){const r=i.default.createTransport({host:"smtp.gmail.com",port:587,auth:{user:"turnomapache@gmail.com",type:"OAuth2",clientId:a.ENV.client_id,clientSecret:a.ENV.client_secret,refreshToken:a.ENV.refresh_token,accessToken:a.ENV.acces_token}}),o={from:"turnomapache@gmail.com",to:e,subject:"turnoMapache - Alta de usuario",html:`\n        <h3>Bienvenido/a!</h3>\n        <br>\n        <p>Le informamos que fue dado/a de alta con éxito, y su contraseña generada aleatoriamente es la siguiente: ${t}</p>\n        <br>\n        <p style='font-size: large;'>turnoMapache</p>\n        `};try{return yield r.sendMail(o),!0}catch(e){return console.log("Error en enviarEmail. ",e),!1}}))}},95:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createHash=void 0;const n=o(r(96));t.createHash=function(e){return n.default.hashSync(e,n.default.genSaltSync(10))}},552:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t="",r="abcdfghijklmnñopqrstuvwxyz01234567890123456789",o=r.length;for(let n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*o));return t}},85:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=o(r(96));t.default=function(e,t){return n.default.compareSync(t,e.contrasenia)}},96:e=>{e.exports=require("bcrypt")},986:e=>{e.exports=require("body-parser")},455:e=>{e.exports=require("compression")},730:e=>{e.exports=require("connect-mongo")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},508:e=>{e.exports=require("express-session")},185:e=>{e.exports=require("mongoose")},184:e=>{e.exports=require("nodemailer")}},t={};!function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(728)})();